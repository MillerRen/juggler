!function(a,b){if("function"==typeof define&&define.amd)define(["marionette","backbone","underscore"],function(c,d,e){return a.Juggler=b(a,c,d,e)});else if("undefined"!=typeof exports){var c=require("marionette"),d=require("backbone"),e=require("underscore");module.exports=b(a,c,d,e)}else a.Juggler=b(a,a.Marionette,a.Backbone,a._)}(this,function(a,b,c){"use strict";var d=a.Juggler,e=c.Juggler=new b.Application;return e.VERSION="0.1.0",e.noConflict=function(){return a.Juggler=d,this},c.Juggler=e,e.AppRouter=b.AppRouter.extend({}),e.Controller=b.Controller.extend({}),e.module("Config",function(a){a.Message={NET_ERROR:"Network error!",NET_SUCCESS:"Network success!"}}),e.module("Templates",function(a,b,c,d,e,f){a.dialog=f.template('<div class="modal-dialog">                <div class="modal-content">                    <div class="modal-header alert alert-<%- type %>">                     <button type="button" class="close" data-dismiss="modal">                     <span aria-hidden="true">&times;</span>                     <span class="sr-only">Close</span></button>                     <h4 class="modal-title"><%= title %></h4>                    </div>                    <div class="modal-body"><%= body %></div>                    <div class="modal-footer">                    <%- footer %>                    </div>                </div>            </div>'),a.alert=f.template('<button type="button" class="close" data-dismiss="alert">            <span aria-hidden="true">&times;</span>            <span class="sr-only">Close</span>        </button>        <span class="alert-message">            <%= message %>        </span>'),a.form=f.template('<div class="fields"></div>            <div class="form-group">            <div class="col-md-10 col-md-offset-2">                <button type="submit" class="btn btn-success btn-submit col-md-2 hidden"></button>            </div>        </div>'),a.form_row=f.template('<label class="col-md-2 control-label" for="<%- cid %>"><%- label %></label>        <div class="col-md-10">            <div class="control-field"></div>            <span class="glyphicon form-control-feedback"></span>            <span class="help-block"><%- errors %></span>        </div>        '),a.navbar=f.template('<div class="<%- container %>">          <div class="navbar-header">            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">              <span class="sr-only">Toggle navigation</span>              <span class="icon-bar"></span>              <span class="icon-bar"></span>              <span class="icon-bar"></span>            </button>            <div class="navbar-brand"><%= brand %></div>          </div>          <div class="collapse navbar-collapse" id="navbar-collapse" data-region="navbar">            <div class="navbar-nav-primary navbar-left">              <ul class="nav navbar-nav"></ul>            </div>            <form class="navbar-form navbar-left"></form>            <div class="navbar-nav-secondary navbar-right"></div>          </div>        </div>'),a.panel=f.template('<div class="panel-heading"><%= header %></div>            <div class="panel-body"><%= body %></div>            <div class="panel-footer"><%= footer %></div>'),a.carousel=f.template('<div id="<%- id %>" class="carousel slide" data-ride="carousel">          <ol class="carousel-indicators">            <% _.each(items,function(item,i){ %>            <li data-target="<%- id %>" data-slide-to="<%- i %>" class="active"></li>            <% }); %>          </ol>          <div class="carousel-inner" role="listbox"></div>          <a class="left carousel-control" href="#<%- id %>" role="button" data-slide="prev">            <span class="glyphicon glyphicon-chevron-left"></span>            <span class="sr-only">Previous</span>          </a>          <a class="right carousel-control" href="#<%- id %>" role="button" data-slide="next">            <span class="glyphicon glyphicon-chevron-right"></span>            <span class="sr-only">Next</span>          </a>        </div>')}),e.module("Enities",function(a,b,c){a.Model=c.Model.extend({urlRoot:"/test",message:b.Config.Message,parse:function(a,b){return b.collection?a:a.data},index:function(){return this.collection.indexOf(this)},reset:function(){this.clear().set(this.defaults)}}),a.Collection=c.Collection.extend({url:"/test",model:a.Model,parse:function(a,b){return b.collection?a:a.data},up:function(a){var b=this.indexOf(a);b>0&&this.swap(b,b-1)},down:function(a){var b=this.indexOf(a);b<this.models.length&&this.swap(b,b+1)},swap:function(a,b){this.models[a]=this.models.splice(b,1,this.models[a])[0]},next:function(a){var b=this.indexOf(a);return this.at(b+1)},prev:function(a){var b=this.indexOf(a);return this.at(b-1)}}),a.Cell=a.Model.extend({}),a.Row=a.Collection.extend({model:a.Cell}),a.Column=a.Model.extend({defaults:{name:void 0,label:void 0,sortable:!1,editable:!1,renderable:!0,formatter:void 0,sortType:"cycle",sortValue:void 0,direction:null,readonly:!0,cell:void 0,headerCell:void 0}}),a.Columns=a.Collection.extend({model:a.Column}),a.Field=a.Model.extend({defaults:{label:"label",editor:"input",checked:!1,errors:[]},validation:function(){return{value:this.get("validator")||{}}}}),a.Fields=a.Collection.extend({model:a.Field}),a.Form=a.Model.extend({}),a.Button=a.Model.extend({defaults:{type:"default",name:"",icon:"",size:""}}),a.Toolbar=a.Collection.extend({}),a.ButtonGroup=a.Collection.extend({model:a.Button})}),e.module("Views",function(a,b,c,d,e,f){a.ItemView=d.ItemView.extend({template:f.template(""),serializeData:function(){var b=a.ItemView.__super__.serializeData.apply(this,arguments);return f.isEmpty(b)?this.options:b}}),a.EmptyView=a.ItemView.extend({className:"alert alert-warning",template:f.template("<%= text %>"),options:{text:"not foundÔºÅ"}}),a.LayoutView=d.LayoutView.extend({className:"row",regionAttr:"data-region",template:f.template(""),render:function(){this.resolveUIRegions(),a.LayoutView.__super__.render.apply(this,arguments),this.resolveTemplateRegions()},resolveUIRegions:function(){if(this.ui)for(var a in this.ui)this.addRegion(a+"Region",this.ui[a])},resolveTemplateRegions:function(){var a=this,b=this.regionAttr,c="["+b+"]";this.$el.find(c).each(function(c,d){var f=e(d).attr(b);f&&a.addRegion(e.camelCase(f)+"Region","["+b+"="+f+"]")}),this.triggerMethod("resoveregion")},serializeData:function(){var b=a.LayoutView.__super__.serializeData.apply(this,arguments);return f.isEmpty(b)?this.options:b}}),a.CompositeView=d.CompositeView.extend({childViewContainer:"",template:f.template(""),childViewOptions:function(a,b){var c={index:b};return this.model&&(c.parentModel=this.model),c},serializeData:function(){var b=a.CompositeView.__super__.serializeData.apply(this,arguments);return f.isEmpty(b)?this.options:b}})}),e.module("Widgets",function(a,b,c,d,e,f){a.Alert=b.Views.ItemView.extend({className:"alert alert-dismissable fade in animated juggler-alert",template:b.Templates.alert,options:{type:"warning",message:"",zIndex:9999,delay:3e3},events:{"close.bs.alert":"onClose"},initialize:function(){var a=this;this.options.delay&&f.delay(function(){a.$el.alert("close")},this.options.delay)},templateHelpers:function(){return this.options},onRender:function(){this.$el.addClass("alert-"+this.options.type).attr("z-index",this.serializeData().zIndex)},onShow:function(){this.$el.css("margin-left",-this.$el.outerWidth()/2+"px")},onClose:function(){this.destroy()}}),a.Progressbar=d.ItemView.extend({className:"progress progress-striped active juggler-progress",template:f.template('<div class="progress-bar"></div>'),options:{type:"success"},ui:{bar:".progress-bar"},modelEvents:{progress:"onProgress"},progress:function(a){return a=0>a?0:a,a=a>100?100:a,a>=100?this.destroy():void this.ui.bar.css("width",a+"%")},onRender:function(){this.ui.bar.addClass("progress-bar-"+this.options.type)},onProgress:function(a){this.progress(a)}}),a.Dialog=b.Views.LayoutView.extend({className:"modal fade",template:b.Templates.dialog,options:{type:"success",size:"md",title:"",body:"",footer:"",buttons:[],backdrop:"static"},ui:{header:".modal-title",body:".modal-body",footer:".modal-footer",buttons:".modal-footer .btn"},templateHelpers:function(){return this.options},onRender:function(){var c=this.serializeData().buttons;this.footerRegion.show(new a.Buttons({collection:new b.Enities.ButtonGroup(c)}))},onShow:function(){this.$el.modal(this.options)},onClose:function(){this.$el.modal("destroy")}}),a.Tooltip=b.Views.ItemView.extend({className:function(){return["tooltip",this.serializeData.placement].join(" ")},template:f.template('<div class="tooltip-arror"></div>                <div class="tooltip-inner"><%- content %></div>'),options:{placement:"top",content:""}}),a.Popover=b.Views.ItemView.extend({className:function(){return["popover",this.serializeData.placement].join(" ")},template:f.template('<div class="tooltip-arror"></div>                <div class="popover-title"><%- title %></div>                <div class="popover-content"><%= content %></div>'),options:{placement:"top",title:"",content:""}})}),e.module("Widgets",function(a,b,c,d,e,f){a.ListItem=b.Views.ItemView.extend({tagName:"li",template:f.template('<a href="#"><%- label %></a>'),triggers:{"click a":"click"}}),a.List=b.Views.CompositeView.extend({tagName:"ul",template:f.template(""),childView:a.ListItem,getChildView:function(b){return f.isEmpty(b.get("items"))?a.List.__super__.getChildView.apply(this,arguments):a.DropdownMenu},childEvents:{click:"onClick"},onClick:function(a){c.history.navigate(a.model.get("name"),{trigger:!0})}}),a.DropdownMenu=a.List.extend({className:"dropdown",tagName:"li",childViewContainer:".dropdown-menu",template:f.template('<a class="dropdown-toggle" data-toggle="dropdown" href="#"><%- label %>            <span class="caret"></span></a><ul class="dropdown-menu"></ul>'),triggers:{"click a":"click"},ui:{toggle:".dropdown-toggle"},onRender:function(){this.ui.toggle.dropdown()}}),a.GroupList=a.List.extend({className:"list-group",childView:a.ListItem.extend({className:"list-group-item"}),childViewOptions:function(){var b=a.GroupList.__super__.childViewOptions.apply(this,arguments);return f.extend(b,{className:"list-group-item"})}}),a.Tabs=a.List.extend({className:"nav nav-tabs",childView:a.ListItem.extend({template:f.template('<a data-toggle="tab" data-target="#<%- name %>"><%- label %></a>')}),collectionEvents:{change:"onChange"},initialize:function(){this._actived=this.serializeData().active||0},active:function(a){this.collection.at(this._actived).unset("active"),this.collection.at(a).set("active",!0),this._actived=a},onRender:function(){this.active(this._actived)},onClick:function(a){this.active(a.model.index())},onChange:function(a){var b=a.index();this.$el.find("a").eq(b).tab("show")}}),a.TabsContent=b.Views.CompositeView.extend({className:"tab-content",childView:b.Views.ItemView.extend({className:function(){return"tab-pane "+(this.serializeData().active?"active":"")},attributes:function(){return{id:this.model.get("name")}},template:f.template("<%= content %>")})}),a.Pills=a.List.extend({className:"nav nav-pills"}),a.Stack=a.List.extend({className:"nav nav-pills nav-stacked"}),a.Nav=a.List.extend({className:"nav navbar-nav"}),a.Breadcrumb=a.List.extend({className:"breadcrumb",onClick:function(a){var b=a.model,d=f.chain(b.collection.toJSON()).first(b.index()+1).pluck("name").value().join("/");c.history.navigate(d)}}),a.Navbar=a.List.extend({tagName:"div",template:b.Templates.navbar,childViewContainer:".navbar-nav",className:"navbar navbar-static-top navbar-default",options:{brand:"Home",container:"container"},ui:{brand:".navbar-brand",primary:".navbar-nav-primary",secondary:".navbar-nav-secondary",form:".navbar-form"}}),a.Pagination=a.List.extend({className:"pagination"}),a.MediaList=a.List.extend({className:"media-list"})}),e.module("Widgets",function(a,b,c,d,e,f){a.Button=a.ListItem.extend({tagName:"button",template:f.template('<i class="<%- icon %>"/> <span><%- name %></span>'),onRender:function(){var a=this.serializeData(),b="btn-"+a.type,c="btn-"+a.size,d=["btn",b,c].join(" ");this.$el.attr("class",d)}}),a.Buttons=a.List.extend({tagName:"div",childView:a.Button}),a.ButtonGroup=b.Views.CompositeView.extend({className:"btn-group",childView:a.Button}),a.Toolbar=b.Views.CompositeView.extend({className:"btn-toolbar",childView:a.ButtonGroup,childViewOptions:function(a){return{collection:new b.Enities.ButtonGroup(a.values())}}})}),e.module("Editors",function(a,b,c,d,e,f){a.Base=b.Views.CompositeView.extend({className:"juggler-editor",template:f.template(""),ui:{input:":input"},setValue:function(){this.ui.input.val(this.model.get("value"))},getValue:function(){return this.ui.input.val()},setSchema:function(){var a=this.serializeData(),b={id:a.cid,placeholder:a.placeholder,name:a.name};this.ui.input.attr(b)},commit:function(){this.model.set({value:this.getValue()}),this.model.validate("value")}}),a.Static=a.Base.extend({template:f.template('<p class="form-control-static"><%- value %></p>')}),a.Input=a.Base.extend({template:f.template('<input type="text" />'),events:{change:"onChange",keyup:"onChange"},modelEvents:{change:"onModelChange"},onRender:function(){this.ui.input.addClass("form-control"),this.setSchema(),this.setValue()},onChange:function(){this.commit()},onModelChange:function(){this.setSchema(),this.setValue()}}),a.Number=a.Input.extend({template:f.template('<input type="number" />')}),a.Email=a.Input.extend({template:f.template('<input type="email" />')}),a.Url=a.Input.extend({template:f.template('<input type="url" />')}),a.Date=a.Input.extend({template:f.template('<input type="date" />')}),a.Datetime=a.Input.extend({template:f.template('<input type="datetime" />')}),a.Textarea=a.Input.extend({template:f.template("<textarea />")}),a.Select=a.Input.extend({template:f.template("<select />"),childViewContainer:"select",childView:b.Views.ItemView.extend({tagName:"option",onRender:function(){var a=this.serializeData();this.$el.prop("value",a.value).text(a.label)}}),initialize:function(){var a=this.serializeData().items;this.collection=this.collection||new b.Enities.Fields(a)}}),a.Radio=a.Base.extend({template:f.template('<div class="radio"></div>'),childViewContainer:".radio",childView:a.Input.extend({tagName:"label",template:f.template('<input type="radio" checked="<%- checked %>"><span><%- label %></span>'),commit:function(){this.model.set("checked",this.ui.input.prop("checked"))},onRender:function(){this.setSchema()}}),collectionEvents:{change:"onCollectionChange"},initialize:function(){var a=this.serializeData().items;this.collection=this.collection||new b.Enities.Fields(a),this.setSchema(),this.setValue()},setSchema:function(){var a=this.model;this.collection.each(function(b){b.set("name",a.get("name"))})},setValue:function(){var a=this.serializeData().value;this.collection.each(function(b){var c=b.get("value");b.set("checked",f.contains(a,c))})},getValue:function(){var a=this.$("input").val();return a},onCollectionChange:function(){this.commit()}}),a.Checkbox=a.Radio.extend({template:f.template('<div class="checkbox"></div>'),childViewContainer:".checkbox",childView:a.Input.extend({tagName:"label",template:f.template('<input type="checkbox"  /><span><%- label %></span>'),commit:function(){var a=this.ui.input.prop("checked");this.model.set("checked",a)},onRender:function(){this.ui.input.prop("checked",this.model.get("checked"))}}),getValue:function(){var a=this.collection.filter(function(a){return a.get("checked")});return a=f.map(a,function(a){return a.get("value")})}})}),e.module("Widgets",function(a,b){a.Field=b.Views.LayoutView.extend({className:"form-group has-feedback",template:b.Templates.form_row,ui:{label:".control-label",field:".control-field",help:".help-block",feedback:".form-control-feedback"},modelEvents:{validated:"onValidate"},initialize:function(){var a=this.options.parentModel.get(this.model.get("name"));this.model.set("value",a),this.model.set("cid",this.model.cid),this._createEditor()},onRender:function(){this.fieldRegion.show(new this.Editor({model:this.model}))},_createEditor:function(){var a=this.model.get("editor").replace(/\w/,function(a){return a.toUpperCase()});this.Editor=b.Editors[a]},onValidate:function(a,b,c){this.$el.attr("class",this.className+" "+(c?"has-error":"has-success")),this.ui.feedback.removeClass(c?"glyphicon-ok":"glyphicon-remove").addClass(c?"glyphicon-remove":"glyphicon-ok"),this.ui.help.text(c&&c.value.join(",")||"")}}),a.Form=b.Views.CompositeView.extend({tagName:"form",childView:a.Field,template:b.Templates.form,childViewContainer:".fields",options:{type:"horizontal",submit:""},ui:{submit:".btn-submit"},events:{"click @ui.submit":"onSubmit"},modelEvents:{request:"disableSubmit",sync:"enableSubmit",change:"onChange"},initialize:function(){this.setType(this.options.type)},setType:function(a){this.$el.removeClass("form-"+this.options.type).addClass("form-"+a),this.options.type=a},commit:function(){var a=this.collection.some(function(a){return!a.isValid("value")}),c=this.collection.reduce(function(a,b){return a.set(b.get("name"),b.get("value"))},new b.Enities.Model);return!a&&this.model.set(c)},submit:function(){var a=this;this.commit()&&this.model.save().success(function(a,c,d){var e=new b.Widgets.Alert({message:d,type:"success"});b.notifyRegion.show(e)}).fail(function(a,c,d){var e=new b.Widgets.Alert({message:d,type:"danger"});b.notifyRegion.show(e)}).complete(function(){a.enableSubmit()})},disableSubmit:function(){this.ui.submit.button("loading")},enableSubmit:function(){this.ui.submit.button("reset")},onRender:function(){this.options.submit?this.ui.submit.removeClass("hidden").text(this.options.submit):this.ui.submit.addClass("hidden")},onChange:function(a){var b=a.changed;this.collection.each(function(a){var c=a.get("name");b[c]&&a.set("value",b[c])})},onSubmit:function(a){a.preventDefault(),this.submit()}})}),e.module("Widgets",function(a,b,c,d,e,f){a.Th=b.Views.ItemView.extend({tagName:"th",template:f.template("<%- value %>")}),a.Td=b.Views.ItemView.extend({tagName:"td",template:f.template("<%= value %>"),events:{click:"onClick"},serializeData:function(){var b=a.Td.__super__.serializeData.apply(this,arguments);return f.extend(b,{value:this.options.parentModel.get(this.model.get("name"))})}}),a.Tr=b.Views.CompositeView.extend({tagName:"tr",childView:a.Td}),a.Thead=b.Views.CompositeView.extend({tagName:"tr",childView:a.Th}),a.Tbody=b.Views.CompositeView.extend({tagName:"tbody",childView:a.Tr,childViewOptions:function(){return{collection:this.options.columns}}}),a.Table=b.Views.LayoutView.extend({tagName:"table",className:"table table-hover table-striped table-bordered",childView:a.Tr,childViewContainer:"tbody",regions:{theadRegion:"thead",tbodyRegion:"tbody",tfootRegion:"tfoot"},template:f.template("<thead></thead><tbody></tbody><tfoot></tfoot>"),initialize:function(){this.head=new a.Thead({collection:this.options.columns,parent:this}),this.body=new a.Tbody({collection:this.collection,columns:this.options.columns}),this.tbodyRegion.attachHtml=function(a){this.$el.replaceWith(a.$el)}},onRender:function(){this.theadRegion.show(this.head),this.tbodyRegion.show(this.body)}})}),e.module("Widgets",function(a,b){a.Panel=b.Views.LayoutView.extend({className:"panel panel-default",template:b.Templates.panel,ui:{header:".panel-heading",body:".panel-body",footer:".panel-footer"},options:{header:"",body:"",footer:""},get:function(a){return this.serializeData()[a]},set:function(a,b){this[a+"Region"].close(),this.model?this.model.set(a,b):(this.options[a]=b,this.ui[a].html(b)),b?this.ui[a].show():this.ui[a].hide()},onRender:function(){this.get("header")?this.ui.header.show():this.ui.header.hide(),this.get("footer")?this.ui.footer.show():this.ui.footer.hide()}})}),e.module("Widgets",function(a,b,c,d,e,f){a.GridLayout=b.Views.LayoutView.extend({className:"grid-layout",template:function(a){var b=a.items||[a],c=f.map(b,function(a){var b=f.map(a,function(a,b){var c,d;return d=f.isNaN(Number(b))?b:"col-"+b,c=f.map(a,function(a,b){return f.isObject(a)?f.map(a,function(a,c){return"col-"+b+"-"+c+(a?"-"+a:"")}).join(" "):"col-"+b+"-"+a}).join(" "),'<div class="'+c+'" data-region="'+d+'"></div>'}).join("");return'<div class="row">'+b+"</div>"}).join("");return c}})}),e.module("Components",function(a,b,c,d,e,f){a.TabsPanels=b.Views.LayoutView.extend({className:"tabs-panels",template:f.template('<div class="tabs"></div><div class="panels"></div>'),regions:{tabsRegion:".tabs",panelsRegion:".panels"},onRender:function(){this.tabsRegion.show(new b.Widgets.Tabs(this.options)),this.panelsRegion.show(new b.Widgets.TabsContent(this.options))}}),a.Navbar=b.Views.LayoutView.extend({className:"navbar",template:b.Templates.navbar,options:{type:"default",position:"static",container:"container",brand:"Juggler"},ui:{brand:".navbar-brand",primary:".navbar-nav-primary",secondary:".navbar-nav-secondary",form:".navbar-form"},templateHelpers:function(){return this.options},onRender:function(){var a=this.options;this.$el.addClass("navbar-"+a.type).addClass("navbar-"+a.position)}}),a.Carousel=b.Views.CompositeView.extend({className:"juggler-carousel",template:b.Templates.carousel,childView:b.Views.ItemView.extend({className:"item",template:f.template('<img src="<%- img %>" />                <div class="carousel-caption"><%- caption %></div>')}),childViewContainer:".carousel-inner",templateHelpers:function(){return{id:this.cid,items:this.collection.toJSON()}},onRender:function(){this.$el.carousel()}})}),e.addInitializer(function(){e.addRegions({headerRegion:"#header",navRegion:"#nav",mainRegion:"#main",footerRegion:"#footer",notifyRegion:"#notify",dialogRegion:"#dialog"})}),e.on("start",function(){c.history&&c.history.start()}),e});