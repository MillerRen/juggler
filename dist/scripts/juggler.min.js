!function(a,b){if("function"==typeof define&&define.amd)define(["marionette","backbone","underscore"],function(c,d,e){return a.Juggler=b(a,c,d,e)});else if("undefined"!=typeof exports){var c=require("marionette"),d=require("backbone"),e=require("underscore");module.exports=b(a,c,d,e)}else a.Juggler=b(a,a.Marionette,a.Backbone,a._)}(this,function(a,b,c){"use strict";var d=a.Juggler,e=c.Juggler=new b.Application;return e.VERSION="0.0.0",e.noConflict=function(){return a.Juggler=d,this},c.Juggler=e,e.module("Config",function(a){a.Message={NET_ERROR:"Network error!",NET_SUCCESS:"Network success!"}}),e.module("Templates",function(a,b,c,d,e,f){a.dialog=f.template('<div class="modal-dialog">                <div class="modal-content">                    <div class="modal-header alert alert-<%- type %>">                     <button type="button" class="close" data-dismiss="modal">                     <span aria-hidden="true">&times;</span>                     <span class="sr-only">Close</span></button>                     <h4 class="modal-title"><%= title %></h4>                    </div>                    <div class="modal-body"><%= body %></div>                    <div class="modal-footer">                    <button class="btn btn-primary"></button>                    </div>                </div>            </div>'),a.alert=f.template('<button type="button" class="close" data-dismiss="alert">            <span aria-hidden="true">&times;</span>            <span class="sr-only">Close</span>        </button>        <span class="alert-message">            <%= message %>        </span>'),a.form=f.template('<div class="fields"></div>            <div class="form-group">            <div class="col-md-10 col-md-offset-2">                <button type="submit" class="btn btn-success btn-submit col-md-2 hidden"></button>            </div>        </div>'),a.form_row=f.template('<label class="col-md-2 control-label" for="<%- cid %>"><%- label %></label>        <div class="col-md-10">            <div class="control-field"></div>            <span class="glyphicon form-control-feedback"></span>            <span class="help-block"><%- errors %></span>        </div>        '),a.navbar=f.template('<div class="container">          <div class="navbar-header">            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">              <span class="sr-only">Toggle navigation</span>              <span class="icon-bar"></span>              <span class="icon-bar"></span>              <span class="icon-bar"></span>            </button>            <a class="navbar-brand" href="#"><%= brand %></a>          </div>          <div class="collapse navbar-collapse" id="navbar-collapse" data-region="navbar">            <ul class="nav navbar-nav navbar-nav-primary"></ul>            <ul class="nav navbar-nav navbar-nav-secondary"></ul>          </div>        </div>'),a.panel=f.template('<div class="panel-heading"><%= header %></div>            <div class="panel-body"><%= body %></div>            <div class="panel-footer"><%= footer %></div>')}),e.module("Enities",function(a,b,c){a.Model=c.RelationalModel.extend({urlRoot:"/test",message:b.Config.Message,parse:function(a,b){return b.collection?a:a.data},index:function(){return this.collection.indexOf(this)},reset:function(){this.clear().set(this.defaults)}}),a.Collection=c.Collection.extend({url:"/test",model:a.Model,parse:function(a,b){return b.collection?a:a.data},up:function(a){var b=this.indexOf(a);b>0&&this.swap(b,b-1)},down:function(a){var b=this.indexOf(a);b<this.models.length&&this.swap(b,b+1)},swap:function(a,b){this.models[a]=this.models.splice(b,1,this.models[a])[0]},next:function(a){var b=this.indexOf(a);return this.at(b+1)},prev:function(a){var b=this.indexOf(a);return this.at(b-1)}}),a.Cell=a.Model.extend({}),a.Row=a.Collection.extend({model:a.Cell}),a.Column=a.Model.extend({defaults:{name:void 0,label:void 0,sortable:!1,editable:!1,renderable:!0,formatter:void 0,sortType:"cycle",sortValue:void 0,direction:null,readonly:!0,cell:void 0,headerCell:void 0}}),a.Columns=a.Collection.extend({model:a.Column}),a.Field=a.Model.extend({defaults:{label:"label",editor:"input",errors:[]},validation:function(){return{value:this.get("validator")||{}}}}),a.Fields=a.Collection.extend({model:a.Field}),a.Form=a.Model.extend({}),a.Button=a.Model.extend({defaults:{type:"default",name:"",icon:"",size:""}}),a.Toolbar=a.Collection.extend({}),a.ButtonGroup=a.Collection.extend({model:a.Button})}),e.module("Views",function(a,b,c,d,e,f){a.ItemView=d.ItemView.extend({template:f.template(""),templateHelpers:function(){return this.options}}),a.EmptyView=a.ItemView.extend({className:"alert alert-warning",template:f.template("<%= text %>"),options:{text:"not foundÔºÅ"}}),a.LayoutView=d.LayoutView.extend({className:"row",regionAttr:"data-region",template:function(){return""},render:function(){this.resolveUIRegions(),a.LayoutView.__super__.render.apply(this,arguments),this.resolveTemplateRegions()},resolveUIRegions:function(){if(this.ui)for(var a in this.ui)this.addRegion(a+"Region",this.ui[a])},resolveTemplateRegions:function(){var a=this,b=this.regionAttr,c="["+b+"]";this.$el.find(c).each(function(c,d){var f=e(d).attr(b);f&&a.addRegion(e.camelCase(f)+"Region","["+b+"="+f+"]")}),this.triggerMethod("resoveregion")},templateHelpers:function(){return this.options}}),a.CompositeView=d.CompositeView.extend({emptyView:a.ItemView,childViewContainer:"",template:f.template(""),childViewOptions:function(a){var c={parentModel:this.model};return a&&a.get("items")&&f.extend(c,{collection:new b.Enities.Collection(a.get("items"))}),c},templateHelpers:function(){return this.options}})}),e.module("Widgets",function(a,b,c,d,e,f){a.Alert=b.Views.ItemView.extend({className:"alert alert-dismissable fade in animated juggler-alert",template:b.Templates.alert,options:{type:"warning",message:"",zIndex:9999,delay:3e3},events:{"close.bs.alert":"onClose"},initialize:function(){var a=this;this.options.delay&&f.delay(function(){a.$el.alert("close")},this.options.delay)},onRender:function(){this.$el.addClass("alert-"+this.options.type).attr("z-index",this.serializeData().zIndex)},onShow:function(){this.$el.css("margin-left",-this.$el.outerWidth()/2+"px")},onClose:function(){this.destroy()}}),a.Progressbar=d.ItemView.extend({className:"progress progress-striped active juggler-progress",template:f.template('<div class="progress-bar"></div>'),options:{type:"success"},ui:{bar:".progress-bar"},modelEvents:{progress:"onProgress"},progress:function(a){return a=0>a?0:a,a=a>100?100:a,a>=100?this.destroy():void this.ui.bar.css("width",a+"%")},onRender:function(){this.ui.bar.addClass("progress-bar-"+this.options.type)},onProgress:function(a){this.progress(a)}}),a.Panel=b.Views.LayoutView.extend({className:"panel panel-default",template:b.Templates.panel,ui:{header:".panel-heading",body:".panel-body",footer:".panel-footer"},options:{header:"",body:"",footer:""},get:function(a){return f.extend(this.serializeData(),this.templateHelpers())[a]},set:function(a,b){this[a+"Region"].close(),this.model?this.model.set(a,b):(this.options[a]=b,this.ui[a].html(b)),b?this.ui[a].show():this.ui[a].hide()},onRender:function(){this.get("header")?this.ui.header.show():this.ui.header.hide(),this.get("footer")?this.ui.footer.show():this.ui.footer.hide()}}),a.ListItem=b.Views.ItemView.extend({tagName:"li",template:f.template("<a><%- label %></a>"),triggers:{"click a":"click"}}),a.List=b.Views.CompositeView.extend({tagName:"ul",template:f.template(""),childView:a.ListItem,getChildView:function(b){return f.isEmpty(b.get("items"))?a.List.__super__.getChildView.apply(this,arguments):a.DropdownMenu},childEvents:{click:"onClick"},onClick:function(a){c.history.navigate(a.model.get("name"))}}),a.DropdownMenu=a.List.extend({className:"dropdown",tagName:"li",childViewContainer:".dropdown-menu",template:f.template('<a class="dropdown-toggle" data-toggle="dropdown" href="#"><%- label %><span class="caret"></span></a><ul class="dropdown-menu"></ul>'),triggers:{"click a":"click"},onRender:function(){this.$el.find(".dropdown-toggle").dropdown()}}),a.GroupList=a.List.extend({className:"list-group",childView:a.ListItem.extend({className:"list-group-item"})}),a.Tabs=a.List.extend({className:"nav nav-tabs",childView:a.ListItem.extend({template:f.template('<a data-toggle="tab" data-target="#<%- name %>"><%- label %></a>')}),collectionEvents:{change:"onChange"},initialize:function(){this._actived=this.serializeData().active||0},active:function(a){this.collection.at(this._actived).unset("active"),this.collection.at(a).set("active",!0),this._actived=a},onRender:function(){this.active(this._actived)},onClick:function(a){this.active(a.model.index())},onChange:function(a){var b=a.index();this.$el.find("a").eq(b).tab("show")}}),a.TabsContent=b.Views.CompositeView.extend({className:"tab-content",childView:b.Views.ItemView.extend({className:function(){return"tab-pane "+(this.serializeData().active?"active":"")},attributes:function(){return{id:this.model.get("name")}},template:f.template("<%= content %>")})}),a.Pills=a.List.extend({className:"nav nav-pills"}),a.Stack=a.List.extend({className:"nav nav-pills nav-stacked"}),a.Nav=a.List.extend({className:"nav navbar-nav"}),a.Breadcrumb=a.List.extend({className:"breadcrumb",onClick:function(a){var b=a.model,d=f.chain(b.collection.toJSON()).first(b.index()+1).pluck("name").value().join("/");c.history.navigate(d)}}),a.Navbar=a.List.extend({tagName:"div",template:b.Templates.navbar,childViewContainer:".navbar-nav-primary",className:"navbar navbar-static-top navbar-default",options:{brand:"Home"}}),a.Pagination=a.List.extend({className:"pagination"}),a.MediaList=a.List.extend({className:"media-list"}),a.Button=a.ListItem.extend({tagName:"button",template:f.template('<i class="<%- icon %>"/> <span><%- name %></span>'),onRender:function(){var a=this.serializeData(),b="btn-"+a.type,c="btn-"+a.size,d=["btn",b,c].join(" ");this.$el.attr("class",d)}}),a.ButtonGroup=b.Views.CompositeView.extend({className:"btn-group",childView:a.Button}),a.Toolbar=b.Views.CompositeView.extend({className:"btn-toolbar",childView:a.ButtonGroup,childViewOptions:function(a){return{collection:new b.Enities.ButtonGroup(a.values())}}}),a.Dialog=b.Views.LayoutView.extend({className:"modal fade",template:b.Templates.dialog,options:{type:"success",size:"md",title:"",body:"",buttons:{positive:{},negative:{}},backdrop:"static"},ui:{header:".modal-title",body:".modal-body",footer:".modal-footer"},get:function(a){return f.extend(this.serializeData(),this.templateHelpers())[a]},set:function(a,b){this[a+"Region"].close(),this.model?this.model.set(a,b):(this.options[a]=b,this.ui[a].html(b)),b?this.ui[a].show():this.ui[a].hide()},onRender:function(){return this.get("header")?this.ui.header.show().html(this.get("header")):this.ui.header.hide(),this.get("footer")?this.ui.footer.show().html(this.get("footer")):this.ui.footer.hide(),this.options.buttons?void 0:void this.ui.footer.remove()},onShow:function(){this.$el.modal(this.options)},onClose:function(){this.$el.modal("destroy")}}),a.Th=b.Views.ItemView.extend({tagName:"th",template:f.template("<%- value %>")}),a.Td=b.Views.ItemView.extend({tagName:"td",template:f.template("<%= value %>"),events:{click:"onClick"},serializeData:function(){var a=this.model.clone();return a.set("value",this.options.parentModel.get(this.model.get("name"))),a.toJSON()},onClick:function(){if(!this.serializeData().readonly&&!this.editor){var a=b.module("Editors.Input");this.editor=new a({model:new b.Enities.Field(this.serializeData())}),this.$el.html(this.editor.render().el),this.editor.focus()}}}),a.Tr=b.Views.CompositeView.extend({tagName:"tr",childView:a.Td}),a.Thead=b.Views.CompositeView.extend({tagName:"tr",childView:a.Th}),a.Tbody=b.Views.CompositeView.extend({tagName:"tbody",childView:a.Tr,childViewOptions:function(){return{collection:this.options.columns}}}),a.Table=b.Views.LayoutView.extend({tagName:"table",className:"table table-hover table-striped table-bordered",childView:a.Tr,childViewContainer:"tbody",regions:{theadRegion:"thead",tbodyRegion:"tbody",tfootRegion:"tfoot"},template:f.template("<thead></thead><tbody></tbody><tfoot></tfoot>"),initialize:function(){this.head=new a.Thead({collection:this.options.columns,parent:this}),this.body=new a.Tbody({collection:this.collection,columns:this.options.columns}),this.tbodyRegion.attachHtml=function(a){this.$el.replaceWith(a.$el)}},onRender:function(){this.theadRegion.show(this.head),this.tbodyRegion.show(this.body)}}),a.GridLayout=b.Views.LayoutView.extend({className:"grid-layout",template:function(a){var b=a.items||[a],c=f.map(b,function(a){var b=f.map(a,function(a,b){var c,d;return d=f.isNaN(Number(b))?b:"col-"+b,c=f.map(a,function(a,b){return f.isObject(a)?f.map(a,function(a,c){return"col-"+b+"-"+c+(a?"-"+a:"")}).join(" "):"col-"+b+"-"+a}).join(" "),'<div class="'+c+'" data-region="'+d+'"></div>'}).join("");return'<div class="row">'+b+"</div>"}).join("");return c}}),a.Field=b.Views.LayoutView.extend({className:"form-group has-feedback",template:b.Templates.form_row,ui:{label:".control-label",field:".control-field",help:".help-block",feedback:".form-control-feedback"},modelEvents:{validated:"onValidate"},initialize:function(){this.model.set("value",this.options.parentModel.get(this.model.get("name"))),this.model.set("cid",this.model.cid)},onRender:function(){this._createEditor()},_createEditor:function(){var a=this.model.get("editor").replace(/\w/,function(a){return a.toUpperCase()}),c=b.Editors[a];c&&this.fieldRegion.show(new c({model:this.model}))},onValidate:function(a,b,c){this.$el.attr("class",this.className+" "+(c?"has-error":"has-success")),this.ui.feedback.removeClass(c?"glyphicon-ok":"glyphicon-remove").addClass(c?"glyphicon-remove":"glyphicon-ok"),this.ui.help.text(c&&c.value.join(",")||"")}}),a.Form=b.Views.CompositeView.extend({tagName:"form",childView:a.Field,template:b.Templates.form,childViewContainer:".fields",options:{type:"horizontal",submit:""},ui:{submit:".btn-submit"},events:{"click @ui.submit":"onSubmit"},modelEvents:{request:"disableSubmit",sync:"enableSubmit"},initialize:function(){this.setType(this.options.type)},setType:function(a){this.$el.removeClass("form-"+this.options.type).addClass("form-"+a),this.options.type=a},commit:function(){var a=this.collection.some(function(a){return!a.isValid()}),c=this.collection.reduce(function(a,b){return a.set(b.get("name"),b.get("value"))},new b.Enities.Model);return console.log(c),!a&&this.model.set(c)},submit:function(){var a=this;this.commit()&&this.model.save().success(function(a,c,d){var e=new b.Widgets.Alert({message:d,type:"success"});b.notifyRegion.show(e)}).fail(function(a,c,d){var e=new b.Widgets.Alert({message:d,type:"danger"});b.notifyRegion.show(e)}).complete(function(){a.enableSubmit()})},disableSubmit:function(){this.ui.submit.button("loading")},enableSubmit:function(){this.ui.submit.button("reset")},onRender:function(){this.options.submit?this.ui.submit.removeClass("hidden").text(this.options.submit):this.ui.submit.addClass("hidden")},onSubmit:function(a){a.preventDefault(),this.submit()}})}),e.module("Editors",function(a,b,c,d,e,f){a.Base=b.Views.ItemView.extend({className:"form-control",attributes:function(){var a=this.serializeData();return{id:a.cid,value:a.value,placeholder:a.placeholder,name:a.name,type:a.editor}},events:{change:"onChange",keyup:"onChange"},focus:function(){this.$el.focus()},onRender:function(){this.$el.attr(this.attributes())},onChange:function(){this.model.set({value:this.$el.val()},{validate:!0})}}),a.Input=a.Base.extend({tagName:"input"}),a.Number=a.Input.extend({}),a.Email=a.Input.extend({}),a.Url=a.Input.extend({}),a.Date=a.Input.extend({}),a.Datetime=a.Input.extend({}),a.Textarea=a.Base.extend({tagName:"textarea",template:f.template("<%- value %>")}),a.Select=a.Base.extend({tagName:"select",template:function(a){return f.map(a.items,function(a){return'<option value="'+a.value+'">'+a.label+"</option>"}).join("")}}),a.CheckboxItem=b.Views.ItemView.extend({tagName:"label",className:"checkbox-inline",template:f.template('<input type="<%- type %>" value="<%- value %>" <%- checked %> /><%- label %>'),serializeData:function(){var a=this.getChecked();return{label:this.model.get("label"),value:this.model.get("value"),name:this.options.parentModel.get("name"),checked:a?"checked":"",type:this.options.parentModel.get("editor")}},getChecked:function(){return f.contains(this.options.parentModel.get("value"),this.model.get("value"))}}),a.Checkbox=b.Views.CompositeView.extend({className:"",childView:a.CheckboxItem,template:f.template(""),events:{"change input":"onChange"},initialize:function(){var a=this.model.get("items");this.collection=new b.Enities.Collection(a)},onRender:function(){console.log(this.model.get("items"))},onChange:function(){{var a=f.map(this.$("input").serializeArray(),function(a){return a.value});this.model.set({value:a},{validate:!0,update:!0})}}}),a.RadioItem=a.CheckboxItem.extend({className:"radio-inline",getChecked:function(){return this.options.parentModel.get("value")==this.model.get("value")}}),a.Radio=a.Checkbox.extend({childView:a.RadioItem})}),e.module("Components",function(a,b,c,d,e,f){a.TabsPanels=b.Views.LayoutView.extend({className:"tabs-panels",template:f.template('<div class="tabs"></div><div class="panels"></div>'),regions:{tabsRegion:".tabs",panelsRegion:".panels"},onRender:function(){this.tabsRegion.show(new b.Widgets.Tabs(this.options)),this.panelsRegion.show(new b.Widgets.TabsContent(this.options))}})}),e.addInitializer(function(){c.Stickit.addHandler({selector:"*",setOptions:{validate:!0}})}),e.addInitializer(function(){e.addRegions({headerRegion:"#header",navRegion:"#nav",mainRegion:"#main",footerRegion:"#footer",notifyRegion:"#notify",dialogRegion:"#dialog"})}),e.on("start",function(){c.history&&c.history.start()}),e});